<mat-card appearance="raised" class="map-data-catalogue" [ngClass]="{'map-data-catalogue--hide-shadow': screenMode === 'mobile'}">
  <mat-card-header
    *ngIf="screenMode !== 'mobile'"
    [ngClass]="{'map-data-catalogue__header--minimized': isMinimized}"
    class="map-data-catalogue__header"
  >
    <h2 class="map-data-catalogue__header__title">Kartenkatalog</h2>
    <button (click)="toggleMinimizeMapDataCatalogue()" mat-icon-button>
      <mat-icon [fontIcon]="isMinimized ? 'arrow_drop_down' : 'arrow_drop_up'"></mat-icon>
    </button>
  </mat-card-header>
  <div [ngClass]="{'map-data-catalogue__content--hidden': isMinimized}" class="map-data-catalogue__content">
    <div *ngIf="screenMode !== 'mobile'" class="map-data-catalogue__content__filter">
      <input #filterInput class="map-data-catalogue__content__filter__input" placeholder="Karten und Layer filtern" type="text" />
      <span class="map-data-catalogue__content__filter__input-icon">
        <mat-icon svgIcon="ktzh_search"></mat-icon>
      </span>
    </div>
    <loading-and-process-bar [loadingState]="catalogueLoadingState"></loading-and-process-bar>
    <mat-accordion
      *ngIf="catalogueLoadingState === 'loaded'"
      [ngClass]="{
        'map-data-catalogue__content__items--hidden': filterString && topics.length === 0 && filteredFavourites.length === 0
      }"
      class="map-data-catalogue__content__items"
      displayMode="flat"
      multi="true"
    >
      <!-- Favourites -->
      <ng-container *ngIf="isAuthenticated">
        <expandable-list-item
          *ngIf="!(!!filterString && filteredFavourites.length === 0)"
          [header]="'Favoriten'"
          [filterString]="filterString"
          [loadingState]="favouritesLoadingState"
          [numberOfItems]="filteredFavourites.length"
          [disabled]="favouritesLoadingState === 'loading' || favouritesLoadingState === 'error'"
        >
          <!-- 'Favourite' content -->
          <p *ngIf="filteredFavourites.length === 0"><em>Noch keine Favoriten hinzugef√ºgt.</em></p>
          <ng-container *ngFor="let favourite of filteredFavourites">
            <map-data-item-favourite
              (addEvent)="addFavouriteToMap(favourite)"
              (deleteEvent)="deleteFavourite(favourite)"
              [filterString]="filterString"
              [invalid]="favourite.invalid"
              [loadingState]="favouritesLoadingState"
              [title]="favourite.title"
            ></map-data-item-favourite>
          </ng-container>
        </expandable-list-item>
      </ng-container>

      <!-- Topics -->
      <ng-container *ngFor="let topic of topics; trackBy: trackByTopicTitle">
        <expandable-list-item
          [topic]="topic"
          [header]="topic.title"
          [filterString]="filterString"
          [expanded]="!!filterString && topic.maps.length <= autoOpenThreshold"
          [loadingState]="catalogueLoadingState"
        >
          <!-- 'Topic' content -->

          <div class="map-data-catalogue__content__items__item__content">
            <ng-container *ngFor="let map of topic.maps; trackBy: trackByMapId; let isLastMap = last">
              <map-data-item-map
                (addEvent)="addActiveMap(map)"
                (addLayerEvent)="addActiveLayer(map, $event)"
                [filterString]="filterString"
                [imageUrl]="map.icon"
                [layers]="map.layers"
                [title]="map.title"
                [gb2Url]="map.gb2Url"
                class="map-data-catalogue__content__items__item__content__item"
              ></map-data-item-map>
              <mat-divider *ngIf="!isLastMap"></mat-divider>
            </ng-container>
          </div>
        </expandable-list-item>
      </ng-container>
    </mat-accordion>

    <p
      *ngIf="filterString && topics.length === 0 && filteredFavourites.length === 0"
      class="map-data-catalogue__content__filter-no-results mat-body-2"
    >
      Keine Resultate zu diesem Filter.
    </p>
  </div>
</mat-card>
